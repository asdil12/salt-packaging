From 57e4e81786e17f24c7370fc02d5188b096287cb0 Mon Sep 17 00:00:00 2001
From: Witek Bedyk <wbedyk@suse.com>
Date: Thu, 19 May 2022 12:52:12 +0200
Subject: [PATCH] Make sure SaltCacheLoader use correct fileclient (#519)

Backported from https://github.com/saltstack/salt/pull/61895

Signed-off-by: Witek Bedyk <witold.bedyk@suse.com>
---
 salt/state.py | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/salt/state.py b/salt/state.py
index cfddb0f170..7e29a5adbb 100644
--- a/salt/state.py
+++ b/salt/state.py
@@ -4291,6 +4291,9 @@ class BaseHighState:
             )
         else:
             try:
+                # Make sure SaltCacheLoader use correct fileclient
+                if context is None:
+                    context = {"fileclient": self.client}
                 state = compile_template(
                     fn_,
                     self.state.rend,
-- 
2.39.2


