From 7e7e022946f08eff9ecce508ddc4438a799528ad Mon Sep 17 00:00:00 2001
From: Witek Bedyk <wbedyk@suse.com>
Date: Thu, 19 May 2022 12:52:12 +0200
Subject: [PATCH] Make sure SaltCacheLoader use correct fileclient (#519)

Backported from https://github.com/saltstack/salt/pull/61895

Signed-off-by: Witek Bedyk <witold.bedyk@suse.com>
---
 salt/state.py | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/salt/state.py b/salt/state.py
index 048b2007ce..96a95ce38a 100644
--- a/salt/state.py
+++ b/salt/state.py
@@ -4286,6 +4286,9 @@ class BaseHighState:
             )
         else:
             try:
+                # Make sure SaltCacheLoader use correct fileclient
+                if context is None:
+                    context = {"fileclient": self.client}
                 state = compile_template(
                     fn_,
                     self.state.rend,
-- 
2.39.2


